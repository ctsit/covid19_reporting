---
title: "Survey Report"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(dotenv)
library(REDCapR)
library(lubridate)
library(janitor)
library(kableExtra)
source("functions.R")
```

```{r}
records <- redcap_read_oneshot(redcap_uri = 'https://redcap.ctsi.ufl.edu/redcap/api/',
                               token = Sys.getenv("TOKEN"))$data %>% 
  filter(!is.na(covid_19_swab_result))

total_tests <- n_distinct(records$record_id, records$redcap_event_name)

checkbox_fields <- records %>% get_checkboxes()  
radio_fields <- records %>% get_radio_cols()
yes_no_fields <- records %>% get_yes_no_cols()

all_fields <- checkbox_fields %>% 
  bind_rows(radio_fields) %>% 
  bind_rows(yes_no_fields) %>% 
  mutate(percent = round((n/total_tests*100),1),
         "n (%)" = paste0(n, " (", percent,")")) %>% 
  select(field_label, "Variable" = label, "n (%)") %>% 
  mutate_at(vars("field_label"), ~ str_remove(., "^If yes, ")) %>% 
  mutate_at(vars("field_label"), ~ str_to_title(.)) %>% 
  arrange(field_label) 
  
```

### Report Run `r Sys.Date()`
This report shows the
```{r}
kable(all_fields %>% select(-field_label), booktabs = T, longtable = T) %>% 
  kable_styling(latex_options = "repeat_header") %>% 
  pack_rows(index = auto_index(all_fields$field_label))
```

